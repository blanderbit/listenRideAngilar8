<div class="wrap-search-page-layout">
  <div class="content search-page-layout" infinite-scroll [infiniteScrollDistance]="5" [scrollWindow]="isMobile || isTablet"
       (scrolled)="onScrollDown($event)" (scrolledUp)="onScrollUp($event)">
    <div *ngIf="isTablet || isMobile" class="mobile-toolbar" [class.scrolled]="scrolled">
      <div class="toggle toggle-filters" (click)="toggleFilters()">
        <mat-icon aria-hidden="false" svgIcon="lnr-filter" aria-label="toggle icon"></mat-icon>
        <span>Filters</span>
      </div>
      <div class="toggle toggle-sorting" (click)="toggleSorting()">
        <mat-icon aria-hidden="false" svgIcon="lnr-sort" aria-label="sort"></mat-icon>
      </div>

    <div class="toggle toggle-map" (click)="toggleMap()">
      <mat-icon *ngIf="!mapToggle" aria-hidden="false" aria-label="toggle icon">map</mat-icon>
      <mat-icon *ngIf="mapToggle" aria-hidden="false" aria-label="toggle icon">list</mat-icon>
      <span *ngIf="!mapToggle">Map</span>
      <span *ngIf="mapToggle">List</span>
    </div>
  </div>
  <div class="toolbar">
    <lnr-filters *ngIf="isDesktop|| !isDesktop && showFilter"></lnr-filters>
    <lnr-mobile-sorting *ngIf="showSorting"></lnr-mobile-sorting>
    <div class="sub-toolbar">
      <div *ngIf="isDesktop || !isDesktop && !mapToggle" class="bikes-for-rent">
        Bikes to rent in {{location.city}} : {{pins.length}}</div>
      <div *ngIf="isDesktop || !isDesktop && !mapToggle" class="bikes-for-groups">
        Bikes rental for large groups</div>
    </div>
  </div>
  <div *ngIf="isDesktop || !isDesktop && !mapToggle" class="flex row direction-row row-wrap m-1">
    <div *ngFor="let ride of bikes" class="bike-tile-grid col-md-6 col-lg-4 col-xs-1 сol-xl-3">
      <lnr-bike-tile
        [brand]="ride.brand"
        [bikeName]="ride.name"
        [image]="ride.image_file"
        [price]="ride.daily_price"
        [weeklyPrice]="ride.weekly_price"
        [ratingAverage]="ride.rating_average"
        [rating]="ride.ratings_total"
        [distance]="ride.distance"
        [clusterParams]="ride.cluster"
        [amount]="ride.cluster ? ride.cluster.variations.length : null"
      ></lnr-bike-tile>
    </div>
  </div>
</div>

<div *ngIf=" isDesktop || !isDesktop && mapToggle" class="map-container">
  <agm-map [latitude]="location.lat" [longitude]="location.lng" [zoom]="10" [styles]="mapStyles">
    <agm-marker-cluster [minimumClusterSize]="2" [styles]="clusterStyles">
      <agm-marker *ngFor="let pin of pins"
                  (markerClick)="openWindow(pin.id)"
                  [latitude]="pin.lat_rnd"
                  [longitude]="pin.lng_rnd"
                  [iconUrl]="{url:'./assets/ui_icons/map/pin_map_white.png', anchor: {x: 28, y: 56},labelOrigin: {x: 28, y: 22}}"
                  [label]="{text: pin.daily_price + '€', color: '#599EFF', fontSize: '13px', fontWeight: 'bold'}"
      >
        <agm-info-window
          [isOpen]="isInfoWindowOpened(pin.id)"
          [latitude]="pin.lat_rnd"
          [longitude]="pin.lng_rnd">

          <lnr-bike-tile
            [brand]="activeBike.brand"
            [bikeName]="activeBike.name"
            [image]="activeBike.image_file"
            [size]="activeBike.size"
            [price]="activeBike.daily_price"
            [weeklyPrice]="activeBike.weekly_price"
            [ratingAverage]="activeBike.rating_average"
            [rating]="activeBike.ratings_total"
            [distance]="activeBike.distance"
            [clusterParams]="activeBike.cluster"
            [amount]="activeBike.cluster ? activeBike.cluster.variations.length : null"
            [isMobileMap]="isTablet"
            [isMapView]="true"
          ></lnr-bike-tile>
        </agm-info-window>

        </agm-marker>
      </agm-marker-cluster>
    </agm-map>
  </div>
</div>
